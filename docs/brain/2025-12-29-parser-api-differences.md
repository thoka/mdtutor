# Parser API Differences - Open Issues

**Date**: 2025-12-29  
**Context**: Comparison between original RPL API and our parser output  
**Tool**: `tools/compare-json.js`

## Overview

This document tracks open issues and differences between the original RPL API output and our parser's output. These are identified through systematic comparison using the `compare-json.js` tool.

## Open Issues

### 1. Missing Fields (can be ignored, not parsed from Markdown)

These fields are present in the original API but are not part of the Markdown source files. They are typically generated by the API server or come from the database:

- `data.id`
- `data.attributes.id`
- `data.attributes.repositoryName`
- `data.attributes.masterLastCommit`
- `data.attributes.archived`
- `data.attributes.unskippable`
- `data.attributes.template`
- `data.attributes.pathwayStep`
- `data.attributes.editorStarterProject`
- `data.attributes.directToEditor`
- `data.attributes.locale`
- `data.attributes.recommendedProjects`
- `data.attributes.nextPathway`
- `data.attributes.recommendedPathways`
- `data.attributes.nextProject`
- `data.attributes.nextPathwayProject`
- `data.relationships`
- `included` (Pathways)

**Status**: Expected differences - these should be ignored in comparisons or handled by the API server layer.

### 2. HTML Content Differences

There are differences in the HTML content of steps between the original API and our parser output.

**Status**: Requires further analysis using `compare-json.js` with HTML normalization.

**Next Steps**:
1. Run detailed comparison with `--normalize-html` flag
2. Identify specific HTML structure differences
3. Determine if differences are:
   - Whitespace/formatting only (acceptable)
   - Structural differences (need fixing)
   - Missing elements (need implementation)

## Resolved Issues

### ✅ Structure Alignment
- `version`, `listed`, `copyedit`, `lastTested` moved to `data.attributes.content` (matching API structure)

### ✅ Block Delimiters
- `--- collapse ---` blocks now correctly converted to panel structure
- YAML frontmatter within collapse blocks is recognized and parsed
- Panel structure generated with title: `<div class="c-project-panel c-project-panel--ingredient">...`

### ✅ YAML Duplicate Keys
- Duplicate `completion:` keys in meta.yml now handled correctly
- Last completion block overwrites the first (matching standard YAML behavior and API interpretation)
- Fixed issue where Step 5 had `['internal','external']` instead of `['external']`
- All completion arrays now match API output

### ✅ Comparison Tool
- Generic JSON comparison tool (`compare-json.js`) created and available

## Related Documentation

- Tool documentation: `tools/doc/PARSER_API_COMPARISON.md`
- Comparison tool: `tools/compare-json.js`

